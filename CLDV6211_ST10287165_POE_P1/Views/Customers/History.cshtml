@model IEnumerable<CLDV6211_ST10287165_POE_P1.Models.OrderHistoryViewModel>

@{
    ViewData["Title"] = "Order History";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<style>
    .modal-content {
        background: #fff;
        border-radius: 8px; /* Rounded corners for modal */
       
    }

    .table {
        margin-top: 20px; /* Spacing for visual comfort */
    }

        .table thead th {
            background-color: darkturquoise; /* Primary color for headers */
            color: black;
           
        }

    .btn-primary {
        background-color: #0056b3; /* Darker shade for buttons for better contrast */
        border: none;
    }

        .btn-primary:hover {
            background-color: turquoise; /* Hover effect */
            color: black;
        }

    .modal-header .modal-title {
        margin-bottom: 0.5rem; /* Adds space below the title */
    }

    .modal-header p {
        font-weight: bold; /* Optional: makes the order number bold */
    }

    .modal-header .modal-title,
    .modal-header p {
        display: block; /* Ensures that both elements are block-level */
    }

    h2 {
        color: #1a1a1a; /* Change the color to suit your theme */
        text-shadow: 0 0 5px #00ffcc; /* Glowing effect */

    }
</style>

<h2>Order History</h2>

<div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <!-- Content will be loaded dynamically -->
        </div>
    </div>
</div>

@if (!Model.Any())
{
    <p class="alert alert-warning">No orders found.</p>
}
else
{
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Date</th>
                    <th>Total Amount</th>
                    <th>          </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var order in Model)
                {
                    <tr>
                        <td>@order.Order.RowKey</td>
                        <td>@order.Order.OrderDate.ToString("yyyy-MM-dd")</td>
                        <td>@String.Format("{0:C}", order.Order.TotalAmount)</td>
                        <td>
                            <button onclick="loadOrderDetails('@order.Order.RowKey')" class="btn btn-primary">View Details</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

<script>
    function loadOrderDetails(orderId) {
        fetch(`/Customers/Details?orderId=${orderId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(html => {
                document.querySelector('#orderDetailsModal .modal-content').innerHTML = html;
                var modal = new bootstrap.Modal(document.getElementById('orderDetailsModal'));
                modal.show();
            })
            .catch(error => {
                console.error('Failed to load order details:', error);
                alert('Failed to load order details');
            });
    }
</script>
