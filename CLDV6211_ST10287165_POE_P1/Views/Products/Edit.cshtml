@model CLDV6211_ST10287165_POE_P1.Models.Product

@{
    ViewData["Title"] = "Edit Product";
}

<h2>Edit Product</h2>

<form asp-action="Edit" method="post" enctype="multipart/form-data">
    <div class="form-group">
        <label asp-for="Name" class="control-label"></label>
        <input asp-for="Name" class="form-control" />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Description" class="control-label"></label>
        <textarea asp-for="Description" class="form-control"></textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Price" class="control-label"></label>
        <input asp-for="Price" class="form-control" />
        <span asp-validation-for="Price" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Category" class="control-label"></label>
        <input asp-for="Category" class="form-control" />
        <span asp-validation-for="Category" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Quantity" class="control-label"></label>
        <input asp-for="Quantity" class="form-control" />
        <span asp-validation-for="Quantity" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label for="inStockDisplay">In Stock:</label>
        <input type="text" id="inStockDisplay" class="form-control" disabled />
        <input type="hidden" asp-for="InStock" />
    </div>

    <div class="form-group">
        <label asp-for="ImageType" class="control-label">Image Source</label>
        <select asp-for="ImageType" class="form-control">
            <option value="Upload">Upload</option>
            <option value="Url">URL</option>
        </select>
        <span asp-validation-for="ImageType" class="text-danger"></span>
    </div>

    <div class="form-group" id="image-upload-section" style="display:none;">
        <label asp-for="ImageUpload" class="control-label">Upload Image</label>
        <input asp-for="ImageUpload" type="file" class="form-control-file" />
        <span asp-validation-for="ImageUpload" class="text-danger"></span>
    </div>

    <div class="form-group" id="image-url-section" style="display:none;">
        <label asp-for="ImageUrl" class="control-label">Image URL</label>
        <input asp-for="ImageUrl" class="form-control" />
        <span asp-validation-for="ImageUrl" class="text-danger"></span>
    </div>

    <div class="form-group">
        <img src="@Model.ImageUrl" alt="Current Image" class="img-thumbnail" style="max-width:200px;" />
        <p>Current Image</p>
    </div>

    <input type="hidden" asp-for="RowKey" />
    <input type="hidden" asp-for="ClientId" />
    <input type="hidden" asp-for="PartitionKey" />

    <button type="submit" class="btn btn-primary">Save Changes</button>
    <a asp-action="Index" class="btn btn-secondary">Cancel</a>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function () {
            function toggleImageSource() {
                var imageType = $('#ImageType').val();
                if (imageType === 'Upload') {
                    $('#image-upload-section').show();
                    $('#image-url-section').hide();
                } else if (imageType === 'Url') {
                    $('#image-upload-section').hide();
                    $('#image-url-section').show();
                } else {
                    $('#image-upload-section').hide();
                    $('#image-url-section').hide();
                }
            }

            toggleImageSource(); // Initial call
            $('#ImageType').change(toggleImageSource); // Handle changes

        });
        document.addEventListener("DOMContentLoaded", function () {
            const quantityInput = document.querySelector('input[name="Quantity"]');
            const inStockDisplay = document.getElementById('inStockDisplay');
            const inStockHiddenInput = document.querySelector('input[name="InStock"]');

            function updateStockStatus() {
                const quantity = parseInt(quantityInput.value, 10) || 0;
                const inStockValue = quantity > 0 ? "In Stock" : "Out of Stock";
                inStockDisplay.value = inStockValue;
                inStockHiddenInput.value = inStockValue;
            }

            // Listen to input event on Quantity to update stock status immediately
            quantityInput.addEventListener('input', updateStockStatus);

            // Initial check on page load
            updateStockStatus();

            // Image input toggle logic
            var imageTypeSelector = document.getElementById('imageType');
            var urlInput = document.getElementById('urlInput');
            var uploadInput = document.getElementById('uploadInput');

            function toggleImageInput(value) {
                urlInput.style.display = (value === 'Url') ? 'block' : 'none';
                uploadInput.style.display = (value === 'Upload') ? 'block' : 'none';
            }

            toggleImageInput(imageTypeSelector.value);
            imageTypeSelector.addEventListener('change', function () {
                toggleImageInput(this.value);
            });
        });
    </script>
}
